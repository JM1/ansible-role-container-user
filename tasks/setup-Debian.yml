---
- set_fact:
    username: "{{ __username|list }}"
  when: username|default(None) == None

- set_fact:
    nopassword: "{{ __nopassword }}"
  when: nopassword|default(None) == None

- name: Cleanup role default variables
  set_fact:
    __username: !!null
    __nopassword: !!null

- name: Fail if required vars are not set
  fail:
  when: >
    username == None or username|length == 0

- apt:
    name: sudo

- template:
    src: "{{ ansible_distribution }}-{{ ansible_distribution_version }}/etc/sudoers.d/username-nopassword-all.j2"
    dest: /etc/sudoers.d/ansible-{{ username }}"
    mode: 440
    owner: root
    group: root
  when: nopassword is defined and nopassword

- set_fact:
    username: !!null
    nopassword: !!null

